(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/burn/burn"],{"21f6":function(e,n,t){},"37de":function(e,n,t){"use strict";var u=t("21f6"),i=t.n(u);i.a},"714f":function(e,n,t){"use strict";(function(e){t("e3a0"),t("921b");u(t("66fd"));var n=u(t("b114"));function u(e){return e&&e.__esModule?e:{default:e}}e(n.default)}).call(this,t("6e42")["createPage"])},b114:function(e,n,t){"use strict";t.r(n);var u=t("be54"),i=t("eb37");for(var r in i)"default"!==r&&function(e){t.d(n,e,function(){return i[e]})}(r);t("37de");var a,s=t("f0c5"),o=Object(s["a"])(i["default"],u["b"],u["c"],!1,null,null,null,!1,u["a"],a);n["default"]=o.exports},be54:function(e,n,t){"use strict";var u,i=function(){var e=this,n=e.$createElement;e._self._c},r=[];t.d(n,"b",function(){return i}),t.d(n,"c",function(){return r}),t.d(n,"a",function(){return u})},d976:function(e,n,t){"use strict";(function(e,u){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=c(t("a34a")),r=t("1989"),a=c(t("64f6")),s=t("ea30"),o=t("8ceb");function c(e){return e&&e.__esModule?e:{default:e}}function l(e,n,t,u,i,r,a){try{var s=e[r](a),o=s.value}catch(c){return void t(c)}s.done?n(o):Promise.resolve(o).then(u,i)}function d(e){return function(){var n=this,t=arguments;return new Promise(function(u,i){var r=e.apply(n,t);function a(e){l(r,u,i,a,s,"next",e)}function s(e){l(r,u,i,a,s,"throw",e)}a(void 0)})}}var f={data:function(){return{format:"",loading:!1,indexBackgroundImage:a.default,images:[],imagecontent:"",burn:{postscript:"",divsnum:"",imagenum:"0005"+(0,s.Thistime)(),id:"",location:"",latitude:"",longitude:"",altitude:"",division:"",time:(0,s.formatDate)((new Date).getTime()),userid:"",username:"",owner:""}}},onLoad:function(){var n=this;try{var t=e.getStorageSync("storage_key");t&&(this.burn.userid=t.userid,this.burn.username=t.username,this.burn.id=t.userid,this.burn.owner=t.userowner)}catch(i){}e.getLocation({geocode:!0,success:function(e){console.log(u(e," at pages\\burn\\burn.vue:92")),n.burn.latitude=e.latitude,n.burn.longitude=e.longitude,n.burn.location=e.address.province+e.address.city+e.address.district}}),plus.sqlite.executeSql({name:"pineinfect",sql:'create table if not exists Burntable("id" INT(10),"location" CHAR(25),"latitude" INT(20),"longitude" INT(20),"altitude" INT(5),"division" INT(2),"divsnum" CHAR(200),"time" CHAR(25),"imagenum" CHAR(25),"userid" INT(10),"username" CHAR(11),"postscript" CHAR(30))',success:function(e){console.log(u("打开Burn表成功!"," at pages\\burn\\burn.vue:105"))},fail:function(e){console.log(u("打开Burn表失败"," at pages\\burn\\burn.vue:108"))}}),plus.sqlite.executeSql({name:"pineinfect",sql:'create table if not exists BurnImagetable("id" INT(10),"imagenum" CHAR(20),"imageorder" CHAR(20),"imagename" CHAR(20),"imageurl" CHAR(30),"imagecontent" CHAR(99999999),"progress" INT(20),"time" CHAR(30),"userid" INT(10),"owner" INT(10),"houzhui" INT(10))',success:function(e){console.log(u("打开BurnImagetable表成功!"," at pages\\burn\\burn.vue:117"))},fail:function(e){console.log(u("打开BurnImagetable表失败"," at pages\\burn\\burn.vue:120"))}})},methods:{Inburnsql:function(){e.navigateTo({url:"../burnsql/burnsql"})},getnum:function(){var e=this.burn.divsnum,n=e.split(";").length-1;this.burn.division=n,console.log(u(this.burn.division," at pages\\burn\\burn.vue:136"))},close:function(e){this.images.splice(e,1)},chooseImg:function(n){var t=this;e.chooseImage({sourceType:["camera"],sizeType:"compressed",count:3-this.images.length,success:function(e){(0,o.pathToBase64)(e.tempFilePaths[0]).then(function(e){var n=e.indexOf("/"),u=e.indexOf(";"),i=e.substr(n+1,u-n-1);t.format=i;var r=e.indexOf(",");t.imagecontent=t.imagecontent.concat(e.substring(r+1,e.length)+";")}).catch(function(e){console.error(u(e," at pages\\burn\\burn.vue:161"))}),t.images=t.images.concat(e.tempFilePaths)}})},previewImage:function(){e.previewImage({urls:this.images})},send:function(){var n=this;n.loading=!0,e.getNetworkType({success:function(){var t=d(i.default.mark(function t(a){var s,o,c;return i.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if("3g"!=a.networkType&&"4g"!=a.networkType&&"wifi"!=a.networkType){t.next=27;break}if(!(n.burn.divsnum.length>0&&n.images.length>0)){t.next=21;break}return t.next=4,(0,r.addBurn)(n.burn);case 4:if(s=t.sent,200!==s.statusCode){t.next=18;break}o=n.imagecontent.split(";"),o.pop(),c=0;case 9:if(!(c<o.length)){t.next=16;break}return t.next=12,(0,r.addImage)({imagecontent:o[c],id:n.burn.id,imagenum:n.burn.imagenum,imageorder:c+1,imagename:c+"."+n.format,progress:5,time:n.burn.time,userid:n.burn.userid,owner:n.burn.owner});case 12:t.sent;case 13:c++,t.next=9;break;case 16:t.next=19;break;case 18:e.showModal({title:"提示",content:"请求失败!"});case 19:t.next=24;break;case 21:return n.loading=!1,e.showModal({title:"提示",content:"请填写完整!"}),t.abrupt("return");case 24:e.showModal({title:"提示",content:"提交成功!",success:function(n){n.confirm,e.navigateBack({delta:1})}}),t.next=28;break;case 27:e.showModal({title:"提示",content:"没有网络，是否存入本地",success:function(t){t.confirm&&(plus.sqlite.executeSql({name:"pineinfect",sql:"insert into BurnImagetable values('"+n.burn.id+"','"+n.burn.imagenum+"','burn','burn.png','"+n.imageurl+"','"+n.imagecontent+"','8','"+n.burn.time+"','"+n.burn.userid+"','"+n.owner+"','"+n.format+"')",success:function(n){console.log(u("添加图片成功!"," at pages\\burn\\burn.vue:263")),e.showToast({icon:"success",title:"添加图片成功!"})},fail:function(n){console.log(u("添加图片失败!"," at pages\\burn\\burn.vue:270")),e.showToast({icon:"none",title:"添加图片失败!"})}}),plus.sqlite.executeSql({name:"pineinfect",sql:"insert into Burntable values('"+n.burn.id+"','"+n.burn.location+"','"+n.burn.latitude+"','"+n.burn.longitude+"','"+n.burn.altitude+"','"+n.burn.division+"','"+n.burn.divsnum+"','"+n.burn.time+"','"+n.burn.imagenum+"','"+n.burn.userid+"','"+n.burn.username+"','"+n.burn.postscript+"')",success:function(t){n.loading=!1,console.log(u("添加信息成功!"," at pages\\burn\\burn.vue:308")),e.showToast({icon:"success",title:"添加信息成功!"})},fail:function(n){console.log(u(n," at pages\\burn\\burn.vue:315")),e.showToast({icon:"none",title:"添加信息失败!"})}}),e.showModal({title:"提示",content:"存入本地成功!",success:function(n){n.confirm&&e.navigateBack({delta:1})}}))}});case 28:case"end":return t.stop()}},t,this)}));function a(e){return t.apply(this,arguments)}return a}()})},scan1:function(){var n=this;e.scanCode({success:function(e){var t=e.result.indexOf(",");n.burn.divsnum=-1==t?n.burn.divsnum.concat(e.result+";"):n.burn.divsnum.concat(e.result.substring(0,t)+";")},fail:function(e){console.log(u(e," at pages\\burn\\burn.vue:351"))}})}}};n.default=f}).call(this,t("6e42")["default"],t("0de9")["default"])},eb37:function(e,n,t){"use strict";t.r(n);var u=t("d976"),i=t.n(u);for(var r in u)"default"!==r&&function(e){t.d(n,e,function(){return u[e]})}(r);n["default"]=i.a}},[["714f","common/runtime","common/vendor"]]]);