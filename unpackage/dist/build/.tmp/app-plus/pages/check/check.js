(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/check/check"],{"80d3":function(e,t,n){"use strict";n.r(t);var c=n("f625"),a=n.n(c);for(var i in c)"default"!==i&&function(e){n.d(t,e,function(){return c[e]})}(i);t["default"]=a.a},"80fe":function(e,t,n){"use strict";var c,a=function(){var e=this,t=e.$createElement;e._self._c},i=[];n.d(t,"b",function(){return a}),n.d(t,"c",function(){return i}),n.d(t,"a",function(){return c})},"831a":function(e,t,n){"use strict";(function(e){n("e3a0"),n("921b");c(n("66fd"));var t=c(n("a54d"));function c(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("6e42")["createPage"])},a54d:function(e,t,n){"use strict";n.r(t);var c=n("80fe"),a=n("80d3");for(var i in a)"default"!==i&&function(e){n.d(t,e,function(){return a[e]})}(i);n("f15d");var o,s=n("f0c5"),u=Object(s["a"])(a["default"],c["b"],c["c"],!1,null,null,null,!1,c["a"],o);t["default"]=u.exports},eeb8:function(e,t,n){},f15d:function(e,t,n){"use strict";var c=n("eeb8"),a=n.n(c);a.a},f625:function(e,t,n){"use strict";(function(e,c){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n("a34a")),i=n("1989"),o=r(n("51a4")),s=n("ea30"),u=n("8ceb");function r(e){return e&&e.__esModule?e:{default:e}}function l(e,t,n,c,a,i,o){try{var s=e[i](o),u=s.value}catch(r){return void n(r)}s.done?t(u):Promise.resolve(u).then(c,a)}function h(e){return function(){var t=this,n=arguments;return new Promise(function(c,a){var i=e.apply(t,n);function o(e){l(i,c,a,o,s,"next",e)}function s(e){l(i,c,a,o,s,"throw",e)}o(void 0)})}}var d={data:function(){return{yimubian:"",kanfaren:"",kanfabei:"",kanfashi:"",diaocharen:"",diaochashi:"",diaochabei:"",diaochaban:"",shigao:"",xiongjing:"",loading:!1,format:"",owner:"",indexBackgroundImage:o.default,items:[{value:"1",name:"合格"},{value:"0",name:"不合格"}],images:[],imagecontent:"",imageurl:"",check:{id:"",userid:"",username:"",stumpnum:"",location:"",latitude:"",longitude:"",altitude:"",quality:"",imagenum:"0008"+(0,s.Thistime)(),postscript:"",time:(0,s.formatDate)((new Date).getTime()),type:""}}},onLoad:function(t){var n=this;try{var a=e.getStorageSync("storage_key");a&&(this.check.userid=a.userid,this.check.username=a.username,this.check.id=a.userid,this.owner=a.owner)}catch(i){}e.getLocation({geocode:!0,success:function(e){n.check.latitude=e.latitude,n.check.longitude=e.longitude,n.check.location=e.address.province+e.address.city+e.address.district}}),plus.sqlite.executeSql({name:"pineinfect",sql:'create table if not exists Checktable("id" INT(10),"userid" INT(10),"username" CHAR(11),"stumpnum" INT(20),"location" CHAR(20),"latitude" INT(20),"longitude" INT(20),"altitude" INT(5),"quality" INT(1),"imagenum" CHAR(30),"postscript" CHAR(30),"time" INT(20),"type" INT(1))',success:function(e){console.log(c("打开Check表成功!"," at pages\\check\\check.vue:136"))},fail:function(e){console.log(c("打开Check表失败"," at pages\\check\\check.vue:139"))}}),plus.sqlite.executeSql({name:"pineinfect",sql:'create table if not exists Imagetable("id" INT(10),"imagenum" CHAR(20),"imageorder" CHAR(20),"imagename" CHAR(20),"imageurl" CHAR(30),"imagecontent" CHAR(99999999),"progress" INT(20),"time" CHAR(30),"userid" INT(10),"owner" INT(10),"houzhui" INT(10))',success:function(e){console.log(c("打开Image表成功!"," at pages\\check\\check.vue:147"))},fail:function(e){console.log(c("打开Image表失败"," at pages\\check\\check.vue:150"))}})},methods:{Inchecksql:function(){e.navigateTo({url:"../checksql/checksql"})},radioChange:function(e){this.check.quality=e.target.value,console.log(c(this.check.quality," at pages\\check\\check.vue:162"))},close:function(e){this.images.splice(e,3)},chooseImg:function(t){var n=this;e.chooseImage({sourceType:["camera"],sizeType:"compressed",count:3,success:function(e){n.imageurl=n.imageurl.concat(e.tempFilePaths+";"),(0,u.pathToBase64)(e.tempFilePaths[0]).then(function(e){var t=e.indexOf("/"),c=e.indexOf(";"),a=e.substr(t+1,c-t-1);n.format=a;var i=e.indexOf(",");n.imagecontent=n.imagecontent.concat(e.substring(i+1,e.length)+";")}).catch(function(e){console.error(c(e," at pages\\check\\check.vue:187"))}),n.images=n.images.concat(e.tempFilePaths)}})},previewImage:function(){e.previewImage({urls:this.images})},addlocation:function(){var t=this;t.check.stumpnum.length>=10&&t.images.length>0?(plus.sqlite.executeSql({name:"pineinfect",sql:"insert into Imagetable values('"+t.check.id+"','"+t.check.imagenum+"','check','check.png','"+t.imageurl+"','"+t.imagecontent+"','8','"+t.check.time+"','"+t.check.userid+"','"+t.owner+"','"+t.format+"')",success:function(t){console.log(c("添加图片成功!"," at pages\\check\\check.vue:229")),e.showToast({title:"添加图片成功!"})},fail:function(t){console.log(c("添加图片失败!"," at pages\\check\\check.vue:235")),e.showToast({icon:"fail",title:"添加图片失败!"})}}),plus.sqlite.executeSql({name:"pineinfect",sql:"insert into Checktable values('"+t.check.id+"','"+t.check.userid+"','"+t.check.username+"','"+t.check.stumpnum+"','"+t.check.location+"','"+t.check.latitude+"','"+t.check.longitude+"','"+t.check.altitude+"','"+t.check.quality+"','"+t.check.imagenum+"','"+t.check.postscript+"','"+t.check.time+"','"+t.check.type+"')",success:function(t){console.log(c("添加信息成功!"," at pages\\check\\check.vue:273")),e.showToast({title:"添加信息成功!"})},fail:function(t){e.showToast({icon:"fail",title:"添加信息失败!"})}}),e.showModal({title:"提示",content:"存入本地成功!",success:function(t){t.confirm&&e.redirectTo({url:"../startNav/startNav",success:function(){e.redirectTo({url:"../check/check"})}})}})):e.showModal({title:"提示",content:"信息填写不完整"})},send:function(){console.log(c(1," at pages\\check\\check.vue:310"));var t=this;t.loading=!0,e.getNetworkType({success:function(){var n=h(a.default.mark(function n(o){var s,u,r;return a.default.wrap(function(n){while(1)switch(n.prev=n.next){case 0:if(console.log(c(o," at pages\\check\\check.vue:315")),"4g"!=o.networkType&&"wifi"!=o.networkType){n.next=35;break}if(!(t.check.stumpnum.length>=10&&t.images.length>0)){n.next=29;break}return e.showLoading({title:"提交中……"}),n.next=6,(0,i.addCheck)(t.check);case 6:if(s=n.sent,setTimeout(function(){e.hideLoading(),t.loading=!1},15e3),1!==s.data){n.next=24;break}u=t.imagecontent.split(";"),u.pop(),r=0;case 12:if(!(r<u.length)){n.next=19;break}return n.next=15,(0,i.addImage)({imagecontent:u[r],id:t.check.id,imagenum:t.check.imagenum,imageorder:r+1,imagename:r+"."+t.format,progress:8,time:t.check.time,owner:t.owner});case 15:n.sent;case 16:r++,n.next=12;break;case 19:t.loading=!1,e.hideLoading(),e.showModal({showCancel:!1,title:"提示",content:"提交成功!",success:function(t){t.confirm&&e.redirectTo({url:"../startNav/startNav",success:function(){e.redirectTo({url:"../check/check"})}})}}),n.next=27;break;case 24:t.loading=!1,e.hideLoading(),e.showModal({showCancel:!1,title:"提示",content:"请求失败，二维码可能重复提交。"});case 27:n.next=33;break;case 29:return t.loading=!1,e.hideLoading(),e.showModal({showCancel:!1,title:"提示",content:"信息不完整或编号格式不正确"}),n.abrupt("return");case 33:n.next=38;break;case 35:t.loading=!1,e.hideLoading(),e.showModal({showCancel:!1,title:"提示",content:"没有网络，是否存入本地",success:function(e){t.addlocation()}});case 38:case"end":return n.stop()}},n,this)}));function o(e){return n.apply(this,arguments)}return o}()})},scan:function(){var t=this;e.scanCode({success:function(){var n=h(a.default.mark(function n(i){var o;return a.default.wrap(function(n){while(1)switch(n.prev=n.next){case 0:return console.log(c(i," at pages\\check\\check.vue:402")),o=i.result.indexOf(","),t.check.stumpnum=-1==o?i.result:i.result.substring(0,o),n.abrupt("return",new Promise(function(n,a){e.request({url:"http://39.96.82.150/pineinfect/jaxrs/dataservice/pine/"+t.check.stumpnum,success:function(n){return console.log(c(n," at pages\\check\\check.vue:414")),t.diaocharen=n.data.username,t.diaochabei=n.data.postscript,t.diaochashi=n.data.time,t.yimubian=n.data.pinenum,t.shugao=n.data.height,t.xiongjing=n.data.dhb,t.diaochaban=n.data.classnum,new Promise(function(n,a){e.request({url:"http://39.96.82.150/pineinfect/jaxrs/dataservice/deal/"+t.check.stumpnum,success:function(n){console.log(c(n," at pages\\check\\check.vue:427")),t.kanfaren=n.data.username,t.kanfashi=n.data.time,t.kanfabei=n.data.postscript,e.showModal({showCancel:!1,title:"疫木信息",content:"疫木编号:"+t.yimubian+"\r\n调查人员:"+t.diaocharen+"\r\n调查时间:"+t.diaochashi+"\r\n调查小班:"+t.diaochaban+"\r\n胸径:"+t.xiongjing+"\r\n树高:"+t.shugao+"\r\n调查备注:"+t.diaochabei+"\r\n砍伐人员:"+t.kanfaren+"\r\n砍伐备注:"+t.kanfabei+"\r\n砍伐时间:"+t.kanfashi+"\r\n"})},fail:function(e){}})})},fail:function(e){}})}));case 4:case"end":return n.stop()}},n,this)}));function i(e){return n.apply(this,arguments)}return i}()})}}};t.default=d}).call(this,n("6e42")["default"],n("0de9")["default"])}},[["831a","common/runtime","common/vendor"]]]);