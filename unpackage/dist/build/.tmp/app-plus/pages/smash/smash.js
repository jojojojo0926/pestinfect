(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/smash/smash"],{"19b1":function(e,s,t){"use strict";var a,n=function(){var e=this,s=e.$createElement;e._self._c},i=[];t.d(s,"b",function(){return n}),t.d(s,"c",function(){return i}),t.d(s,"a",function(){return a})},"1b24":function(e,s,t){},"2c81":function(e,s,t){"use strict";(function(e){t("e3a0"),t("921b");a(t("66fd"));var s=a(t("59dc"));function a(e){return e&&e.__esModule?e:{default:e}}e(s.default)}).call(this,t("6e42")["createPage"])},"59dc":function(e,s,t){"use strict";t.r(s);var a=t("19b1"),n=t("f3da");for(var i in n)"default"!==i&&function(e){t.d(s,e,function(){return n[e]})}(i);t("d4f0");var o,u=t("f0c5"),c=Object(u["a"])(n["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],o);s["default"]=c.exports},d4f0:function(e,s,t){"use strict";var a=t("1b24"),n=t.n(a);n.a},f3da:function(e,s,t){"use strict";t.r(s);var a=t("ff8c"),n=t.n(a);for(var i in a)"default"!==i&&function(e){t.d(s,e,function(){return a[e]})}(i);s["default"]=n.a},ff8c:function(e,s,t){"use strict";(function(e,a){Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var n=r(t("a34a")),i=t("1989"),o=r(t("6bbd")),u=t("ea30"),c=t("8ceb");function r(e){return e&&e.__esModule?e:{default:e}}function m(e,s,t,a,n,i,o){try{var u=e[i](o),c=u.value}catch(r){return void t(r)}u.done?s(c):Promise.resolve(c).then(a,n)}function l(e){return function(){var s=this,t=arguments;return new Promise(function(a,n){var i=e.apply(s,t);function o(e){m(i,a,n,o,u,"next",e)}function u(e){m(i,a,n,o,u,"throw",e)}o(void 0)})}}var h={data:function(){return{loading:!1,indexBackgroundImage:o.default,format:"",images:[],imagecontent:"",smash:{owner:"",postscript:"",divsnum:"",imagenum:"0006"+(0,u.Thistime)(),id:"",location:"",latitude:"",longitude:"",altitude:"",division:"",time:(0,u.formatDate)((new Date).getTime()),userid:"",username:""}}},onLoad:function(s){var t=this;try{var n=e.getStorageSync("storage_key");n&&(this.smash.userid=n.userid,this.smash.username=n.username,this.smash.id=n.userid,this.smash.owner=n.owner)}catch(i){}e.getLocation({geocode:!0,success:function(e){t.smash.latitude=e.latitude,t.smash.longitude=e.longitude,t.smash.location=e.address.province+e.address.city+e.address.district}}),plus.sqlite.executeSql({name:"pineinfect",sql:'create table if not exists Smashtable("id" INT(10),"location" CHAR(25),"latitude" INT(20),"longitude" INT(20),"altitude" INT(5),"division" INT(2),"divsnum" CHAR(200),"time" CHAR(25),"imagenum" CHAR(25),"userid" INT(10),"username" CHAR(11),"postscript" CHAR(30))',success:function(e){console.log(a("打开Smash表成功!"," at pages\\smash\\smash.vue:101"))},fail:function(e){console.log(a("打开Smash表失败"," at pages\\smash\\smash.vue:104"))}}),plus.sqlite.executeSql({name:"pineinfect",sql:'create table if not exists  SmashImagetable("id" INT(10),"imagenum" CHAR(20),"imageorder" CHAR(20),"imagename" CHAR(20),"imageurl" CHAR(30),"imagecontent" CHAR(99999999),"progress" INT(20),"time" CHAR(30),"userid" INT(10),"owner" INT(10),"houzhui" INT(10))',success:function(e){console.log(a("打开SmashImagetable表成功!"," at pages\\smash\\smash.vue:113"))},fail:function(e){console.log(a("打开SmashImagetable表失败"," at pages\\smash\\smash.vue:116"))}})},methods:{Insmashsql:function(){e.navigateTo({url:"../smashsql/smashsql"})},getnum:function(){var e=this.smash.divsnum,s=e.split(";").length-1;this.smash.division=s,console.log(a(this.smash.division," at pages\\smash\\smash.vue:130"))},close:function(e){this.images.splice(e,1)},chooseImg:function(s){var t=this;e.chooseImage({sourceType:["camera"],sizeType:"compressed",count:3-this.images.length,success:function(e){(0,c.pathToBase64)(e.tempFilePaths[0]).then(function(e){var s=e.indexOf("/"),a=e.indexOf(";"),n=e.substr(s+1,a-s-1);t.format=n;var i=e.indexOf(",");t.imagecontent=t.imagecontent.concat(e.substring(i+1,e.length)+";")}).catch(function(e){console.error(a(e," at pages\\smash\\smash.vue:154"))}),t.images=t.images.concat(e.tempFilePaths)}})},previewImage:function(){e.previewImage({urls:this.images})},send:function(){var s=this;s.loading=!0,e.getNetworkType({success:function(){var t=l(n.default.mark(function t(o){var u,c,r;return n.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if("3g"!=o.networkType&&"4g"!=o.networkType&&"wifi"!=o.networkType){t.next=27;break}if(!(s.smash.divsnum.length>0&&s.images.length>0)){t.next=21;break}return t.next=4,(0,i.addSmash)(s.smash);case 4:if(u=t.sent,200!==u.statusCode){t.next=18;break}c=s.imagecontent.split(";"),c.pop(),r=0;case 9:if(!(r<c.length)){t.next=16;break}return t.next=12,(0,i.addImage)({imagecontent:c[r],id:s.smash.id,imagenum:s.smash.imagenum,imageorder:r+1,imagename:r+"."+s.format,progress:6,time:s.smash.time,userid:s.smash.userid,owner:s.smash.owner});case 12:t.sent;case 13:r++,t.next=9;break;case 16:t.next=19;break;case 18:e.showModal({title:"提示",content:"请求失败!"});case 19:t.next=24;break;case 21:return s.loading=!1,e.showModal({title:"提示",content:"请填写完整!"}),t.abrupt("return");case 24:e.showModal({title:"提示",content:"提交成功!",success:function(s){s.confirm,e.navigateBack({delta:1})}}),t.next=28;break;case 27:e.showModal({title:"提示",content:"没有网络，是否存入本地",success:function(t){t.confirm&&(plus.sqlite.executeSql({name:"pineinfect",sql:"insert into  SmashImagetable values('"+s.smash.id+"','"+s.smash.imagenum+"','smash','smash.png','"+s.imageurl+"','"+s.imagecontent+"','6','"+s.smash.time+"','"+s.smash.userid+"','"+s.owner+"','"+s.format+"')",success:function(s){console.log(a("添加图片成功!"," at pages\\smash\\smash.vue:254")),e.showToast({title:"添加图片成功!"})},fail:function(s){console.log(a("添加图片失败!"," at pages\\smash\\smash.vue:260")),e.showToast({icon:"fail",title:"添加图片失败!"})}}),plus.sqlite.executeSql({name:"pineinfect",sql:"insert into Smashtable values('"+s.smash.id+"','"+s.smash.location+"','"+s.smash.latitude+"','"+s.smash.longitude+"','"+s.smash.altitude+"','"+s.smash.division+"','"+s.smash.divsnum+"','"+s.smash.time+"','"+s.smash.imagenum+"','"+s.smash.userid+"','"+s.smash.username+"','"+s.smash.postscript+"')",success:function(s){console.log(a("添加信息成功!"," at pages\\smash\\smash.vue:296")),e.showToast({title:"添加信息成功!"})},fail:function(s){e.showToast({icon:"fail",title:"添加信息失败!"})}}),e.showModal({title:"提示",content:"存入本地成功!",success:function(t){s.loading=!1,t.confirm&&e.navigateBack({delta:1})}}))}});case 28:case"end":return t.stop()}},t,this)}));function o(e){return t.apply(this,arguments)}return o}()})},scan:function(){var s=this;e.scanCode({success:function(e){var t=e.result.indexOf(",");s.smash.divsnum=-1==t?s.smash.divsnum.concat(e.result+";"):s.smash.divsnum.concat(e.result.substring(0,t)+";")}})}}};s.default=h}).call(this,t("6e42")["default"],t("0de9")["default"])}},[["2c81","common/runtime","common/vendor"]]]);