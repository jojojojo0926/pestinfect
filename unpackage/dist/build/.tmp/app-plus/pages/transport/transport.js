(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/transport/transport"],{"01d0":function(t,e,n){"use strict";var r=n("99d3"),a=n.n(r);a.a},"2daf":function(t,e,n){"use strict";n.r(e);var r=n("549c"),a=n.n(r);for(var s in r)"default"!==s&&function(t){n.d(e,t,function(){return r[t]})}(s);e["default"]=a.a},"32a4":function(t,e,n){"use strict";n.r(e);var r=n("f0ff"),a=n("2daf");for(var s in a)"default"!==s&&function(t){n.d(e,t,function(){return a[t]})}(s);n("01d0");var o,i=n("f0c5"),u=Object(i["a"])(a["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],o);e["default"]=u.exports},"549c":function(t,e,n){"use strict";(function(t,r){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=c(n("a34a")),s=n("1989"),o=c(n("071a")),i=n("ea30"),u=n("8ceb");function c(t){return t&&t.__esModule?t:{default:t}}function l(t,e,n,r,a,s,o){try{var i=t[s](o),u=i.value}catch(c){return void n(c)}i.done?e(u):Promise.resolve(u).then(r,a)}function p(t){return function(){var e=this,n=arguments;return new Promise(function(r,a){var s=t.apply(e,n);function o(t){l(s,r,a,o,i,"next",t)}function i(t){l(s,r,a,o,i,"throw",t)}o(void 0)})}}var d={data:function(){return{format:"",loading:!1,indexBackgroundImage:o.default,images:[],imagecontent:"",transport:{owner:"",carnum:"",driver:"",destination:"",divsnum:"",imagenum:"0007"+(0,i.Thistime)(),id:"",location:"",latitude:"",longitude:"",altitude:"",division:"",time:(0,i.formatDate)((new Date).getTime()),userid:"",username:"",postscript:""}}},onLoad:function(e){var n=this;try{var a=t.getStorageSync("storage_key");a&&(this.transport.userid=a.userid,this.transport.username=a.username,this.transport.id=a.userid,this.transport.owner=a.owner)}catch(s){}t.getLocation({geocode:!0,success:function(t){n.transport.latitude=t.latitude,n.transport.longitude=t.longitude,n.transport.location=t.address.province+t.address.city+t.address.district}}),plus.sqlite.executeSql({name:"pineinfect",sql:'create table if not exists Transporttable("id" INT(10),"carnum" CHAR(10),"driver" CHAR(10),"location" CHAR(25),"latitude" INT(20),"longitude" INT(20),"altitude" INT(5),"destination" CHAR(20),"division" INT(2),"divsnum" CHAR(200),"time" CHAR(25),"imagenum" CHAR(25),"userid" INT(10),"username" CHAR(11),"postscript" CHAR(30))',success:function(t){console.log(r("打开Transoprt表成功!"," at pages\\transport\\transport.vue:116"))},fail:function(t){console.log(r("打开Transoprt表失败"," at pages\\transport\\transport.vue:119"))}}),plus.sqlite.executeSql({name:"pineinfect",sql:'create table if not exists TransoprtImagetable("id" INT(10),"imagenum" CHAR(20),"imageorder" CHAR(20),"imagename" CHAR(20),"imageurl" CHAR(30),"imagecontent" CHAR(99999999),"progress" INT(20),"time" CHAR(30),"userid" INT(10),"owner" INT(10),"houzhui" INT(10))',success:function(t){console.log(r("打开TransoprtImagetable表成功!"," at pages\\transport\\transport.vue:128"))},fail:function(t){console.log(r("打开TransoprtImagetable表失败"," at pages\\transport\\transport.vue:131"))}})},methods:{Intransportsql:function(){t.navigateTo({url:"../transportsql/transportsql"})},getnum:function(){var t=this.transport.divsnum,e=t.split(";").length-1;this.transport.division=e,console.log(r(this.transport.division," at pages\\transport\\transport.vue:146"))},close:function(t){this.images.splice(t,1)},chooseImg:function(e){var n=this;t.chooseImage({sourceType:["camera"],sizeType:"compressed",count:3-this.images.length,success:function(t){(0,u.pathToBase64)(t.tempFilePaths[0]).then(function(t){var e=t.indexOf("/"),r=t.indexOf(";"),a=t.substr(e+1,r-e-1);n.format=a;var s=t.indexOf(",");n.imagecontent=n.imagecontent.concat(t.substring(s+1,t.length)+";")}).catch(function(t){console.error(r(t," at pages\\transport\\transport.vue:170"))}),n.images=n.images.concat(t.tempFilePaths)}})},previewImage:function(){t.previewImage({urls:this.images})},send:function(){var e=this;e.loading=!0,t.getNetworkType({success:function(){var n=p(a.default.mark(function n(o){var i,u,c;return a.default.wrap(function(n){while(1)switch(n.prev=n.next){case 0:if("3g"!=o.networkType&&"4g"!=o.networkType&&"wifi"!=o.networkType){n.next=27;break}if(!(e.transport.divsnum.length>0&&e.images.length>0)){n.next=21;break}return n.next=4,(0,s.addTransport)(e.transport);case 4:if(i=n.sent,200!==i.statusCode){n.next=18;break}u=e.imagecontent.split(";"),u.pop(),c=0;case 9:if(!(c<u.length)){n.next=16;break}return n.next=12,(0,s.addImage)({imagecontent:u[c],id:e.transport.id,imagenum:e.transport.imagenum,imageorder:c+1,imagename:c+"."+e.format,progress:7,time:e.transport.time,userid:e.transport.userid,owner:e.transport.owner});case 12:n.sent;case 13:c++,n.next=9;break;case 16:n.next=19;break;case 18:t.showModal({title:"提示",content:"请求失败!"});case 19:n.next=24;break;case 21:return e.loading=!1,t.showModal({title:"提示",content:"请填写完整!"}),n.abrupt("return");case 24:t.showModal({title:"提示",content:"提交成功!",success:function(e){e.confirm,t.navigateBack({delta:1})}}),n.next=28;break;case 27:t.showModal({title:"提示",content:"没有网络，是否存入本地",success:function(n){n.confirm&&(plus.sqlite.executeSql({name:"pineinfect",sql:"insert into TransoprtImagetable values('"+e.transport.id+"','"+e.transport.imagenum+"','transport','transport.png','"+e.imageurl+"','"+e.imagecontent+"','7','"+e.transport.time+"','"+e.transport.userid+"','"+e.owner+"','"+e.format+"')",success:function(e){console.log(r("添加图片成功!"," at pages\\transport\\transport.vue:270")),t.showToast({title:"添加图片成功!"})},fail:function(e){console.log(r("添加图片失败!"," at pages\\transport\\transport.vue:276")),t.showToast({icon:"fail",title:"添加图片失败!"})}}),plus.sqlite.executeSql({name:"pineinfect",sql:"insert into Transporttable values('"+e.transport.id+"','"+e.transport.carnum+"','"+e.transport.driver+"','"+e.transport.location+"','"+e.transport.latitude+"','"+e.transport.longitude+"','"+e.transport.altitude+"','"+e.transport.destination+"','"+e.transport.division+"','"+e.transport.divsnum+"','"+e.transport.time+"','"+e.transport.imagenum+"','"+e.transport.userid+"','"+e.transport.username+"','"+e.transport.postscript+"')",success:function(e){console.log(r("添加信息成功!"," at pages\\transport\\transport.vue:318")),t.showToast({title:"添加信息成功!"})},fail:function(e){t.showToast({icon:"fail",title:"添加信息失败!"})}}),t.showModal({title:"提示",content:"存入本地成功!",success:function(n){e.loading=!1,n.confirm&&t.navigateBack({delta:1})}}))}});case 28:case"end":return n.stop()}},n,this)}));function o(t){return n.apply(this,arguments)}return o}()})},scan1:function(){var e=this;t.scanCode({success:function(t){var n=t.result.indexOf(",");e.transport.divsnum=-1==n?e.transport.divsnum.concat(t.result+";"):e.transport.divsnum.concat(t.result.substring(0,n)+";")},fail:function(t){console.log(r(t," at pages\\transport\\transport.vue:360"))}})}}};e.default=d}).call(this,n("6e42")["default"],n("0de9")["default"])},"99d3":function(t,e,n){},be6d:function(t,e,n){"use strict";(function(t){n("e3a0"),n("921b");r(n("66fd"));var e=r(n("32a4"));function r(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("6e42")["createPage"])},f0ff:function(t,e,n){"use strict";var r,a=function(){var t=this,e=t.$createElement;t._self._c},s=[];n.d(e,"b",function(){return a}),n.d(e,"c",function(){return s}),n.d(e,"a",function(){return r})}},[["be6d","common/runtime","common/vendor"]]]);